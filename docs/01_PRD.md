# DOC-1: PRD (제품 요구사항 정의서)

## 1.1 문제 정의

현대 기업 환경에서 DBA는 Oracle, MySQL, PostgreSQL, SQL Server 등 이기종 데이터베이스를 운영한다. 현재 모니터링은 Grafana 같은 웹 기반 도구에 의존하고 있어 다음과 같은 문제가 발생한다.

**비유:** 각 공장(DBMS)마다 전문 계기판이 있지만, 모두 웹 브라우저에서만 볼 수 있다. SSH만 가능한 야간 장애 상황에서는 계기판을 볼 수 없다. DIT (DBmon-In-Terminal)는 터미널 안에서 각 공장의 전문 계기판을 제공하되, 빠른 전환으로 다른 공장도 즉시 확인할 수 있다.

**핵심 문제:**

- SSH 접속 환경(터미널)에서는 웹 기반 Grafana 대시보드를 사용할 수 없다
- 경량 서버 환경(GUI 없음)에서 실시간 모니터링이 불가능하다
- 야간 장애 대응 시 노트북에서 SSH로 빠르게 접속해야 하는데, 기존 도구는 무겁다
- 기존 Grafana 대시보드의 풍부한 메트릭을 터미널에서도 동일하게 보고 싶다

## 1.2 제품 목표

DIT (DBmon-In-Terminal)는 **리눅스 터미널(TUI)에서 실행되는 데이터베이스 모니터링 시스템**이다. s-tui(Stress Terminal UI)처럼 터미널 안에서 시계열 차트 스택과 실시간 게이지를 보여주며, DBMS별로 전문적인 메트릭을 모니터링한다.

**목표 1 — DBMS별 전문 모니터링:** 선택한 DB 인스턴스를 s-tui 스타일의 시계열 차트 스택으로 전문적으로 모니터링한다. 좌측에 메트릭별 차트 스택, 우측에 인스턴스 선택기와 현재값 사이드바를 배치한다.

**목표 2 — Grafana급 메트릭 커버리지:** 기존 Grafana 대시보드 + Prometheus Exporter에서 수집하는 메트릭을 터미널에서 동일하게 제공한다. DBMS별로 전문화된 메트릭 그룹(CPU, Sessions, I/O, Wait Events, Top SQLs 등)을 지원한다.

**목표 3 — 경량·무설치 원격 접근:** SSH 접속만으로 사용 가능하며, X Window나 웹 브라우저가 필요 없다. Python 단일 패키지로 설치한다.

**목표 4 — 빠른 인스턴스 전환:** 사이드바에서 등록된 DB 인스턴스를 화살표 키로 빠르게 전환하며, DBMS 유형에 맞는 메트릭 그룹이 자동 로드된다.

**목표 5 — 알림 및 임계치 관리:** 설정한 임계치 초과 시 터미널 내 시각적 경고, 선택적으로 Slack/이메일 알림을 발송한다.

## 1.3 지원 DBMS

| DBMS | 지원 상태 | Grafana 대시보드 | Exporter |
|------|-----------|-----------------|----------|
| Oracle | ✅ 지원 | 9개 대시보드 | `oracledb_exporter` + custom TOML |
| MySQL / MariaDB | ✅ 지원 | 5개 대시보드 | `mysqld_exporter` + custom YAML |
| PostgreSQL | ✅ 지원 | 5개 대시보드 | `postgres_exporter` + custom queries |
| SQL Server | ✅ 지원 | 10개 대시보드 | `sql_exporter` + custom YAML |
| Tibero | 🔜 예정 | 미정 | 미정 |

## 1.4 사용자 페르소나

**페르소나 1 — 시니어 DBA "민수" (Primary)**
- 30년 경력의 Oracle/PostgreSQL 전문가
- 야간 장애 대응 시 SSH 터미널에서 Grafana 수준의 모니터링이 필요하다
- DBMS별로 전문적인 메트릭을 확인하고, 인스턴스를 빠르게 전환하고 싶다
- CLI 도구에 익숙하며, 키보드 단축키를 선호한다

**페르소나 2 — DevOps 엔지니어 "지현" (Secondary)**
- 인프라와 데이터베이스를 함께 관리한다
- 서버에 GUI가 없어 터미널 기반 모니터링이 필수다
- 임계치 초과 시 Slack 알림을 받아 빠르게 대응하고 싶다

**페르소나 3 — 주니어 DBA "승호" (Tertiary)**
- 다양한 DB 경험이 부족하여 DBMS별 핵심 지표를 학습하고 싶다
- 직관적인 시계열 시각화가 이해에 도움이 된다

## 1.5 사용자 스토리

| ID | 사용자 | 스토리 | 우선순위 |
|----|--------|--------|----------|
| US-01 | 민수 | SSH 터미널에서 `dit` 명령어로 s-tui 스타일의 DB 모니터링 화면을 열고 싶다 | P0 |
| US-02 | 민수 | 사이드바에서 DB 인스턴스를 선택하면 해당 DBMS의 전문 메트릭 차트 스택이 표시되길 원한다 | P0 |
| US-03 | 민수 | 시계열 차트(바/라인)로 CPU, Sessions, Wait Events 추이를 실시간으로 보고 싶다 | P0 |
| US-04 | 지현 | YAML 파일 하나로 모니터링 대상 DB와 임계치를 설정하고 싶다 | P0 |
| US-05 | 지현 | CPU 사용률이 80%를 넘으면 터미널 경고와 동시에 Slack 알림을 받고 싶다 | P1 |
| US-06 | 지현 | `pip install dit-monitor`로 어디서든 3분 내에 설치하고 싶다 | P1 |
| US-07 | 승호 | DBMS 유형별로 Grafana와 동일한 메트릭 그룹이 기본 제공되어 별도 설정 없이 시작하고 싶다 | P1 |
| US-08 | 민수 | Tab 키로 메트릭 그룹(Overview/Sessions/I-O/Wait/SQL)을 빠르게 전환하고 싶다 | P0 |
| US-09 | 민수 | 장기 실행 쿼리(Long Running Query) 목록을 실시간으로 확인하고 kill 할 수 있으면 좋겠다 | P2 |
| US-10 | 민수 | 과거 24시간의 지표 추이를 터미널에서 시계열 그래프로 확인하고 싶다 | P1 |
| US-11 | 승호 | 지표가 정상 범위를 벗어나면 색상과 아이콘으로 즉시 인지하고 싶다 | P1 |
| US-12 | 민수 | 이기종 DB 간 동일 지표(커넥션 수, 쿼리 응답시간)를 나란히 비교하고 싶다 | P3 |

## 1.6 성공 지표

| 지표 | 목표값 | 측정 방법 |
|------|--------|-----------|
| 설치 ~ 첫 대시보드 표시 시간 | 5분 이내 | 신규 서버 배포 테스트 |
| 대시보드 갱신 주기 | 1~5초 (설정 가능) | 내부 타이머 측정 |
| 터미널 응답 지연 | 100ms 미만 (키 입력 ~ 화면 반응) | 프레임 렌더링 시간 측정 |
| 동시 모니터링 DB 인스턴스 수 | 최소 20개 (등록 기준) | 설정 테스트 |
| 메모리 사용량 | 200MB 이하 | 프로파일링 |
| Grafana 대비 메트릭 커버리지 | Overview 대시보드 기준 100% | 메트릭 체크리스트 |

## 1.7 범위 외 항목 (Non-goals)

- 웹 기반 대시보드 (Grafana, Datadog 등의 대체재가 아님 — 보완재)
- 쿼리 튜닝 자동화 (지표 모니터링까지만, 자동 최적화는 범위 외)
- 데이터베이스 관리 작업 (백업, 복구, 마이그레이션)
- Windows 터미널 지원 (Linux/macOS 터미널 우선)
- Prometheus/Grafana 연동 (독립 실행 도구)

## 1.8 가정과 리스크

**가정:**
- 모니터링 대상 DB에 읽기 전용 계정으로 접속 가능하다
- 터미널은 256색 이상을 지원한다 (대부분의 현대 터미널 에뮬레이터)
- Python 3.10 이상이 설치되어 있다
- 네트워크를 통해 대상 DB 포트에 접근 가능하다

**리스크:**

| 리스크 | 영향 | 대응 방안 |
|--------|------|-----------|
| 터미널 크기가 작으면 차트가 깨진다 | UX 저하 | 반응형 레이아웃 + 최소 크기 경고 |
| DB 접속 지연이 UI를 멈추게 한다 | 차트 멈춤 | 비동기 I/O(asyncio) 기반 수집 |
| 대량 지표 수집 시 DB 부하 발생 | 운영 DB 성능 저하 | 수집 주기 조절 + Exporter와 동일한 경량 쿼리 사용 |
| Oracle client/패키지 설치 복잡 | 진입 장벽 | Java 8+ 단일 bridge JAR 배포(오프라인 앱 서버 대응) |

## 1.9 해결 가설

"리눅스 터미널에서 실행되는 s-tui 스타일의 DBMS별 전문 모니터링 도구를 제공하면, DBA가 SSH 환경에서도 Grafana 수준의 메트릭을 실시간으로 확인할 수 있어, 장애 인지 시간을 평균 5분에서 30초 이내로 단축할 수 있다."
