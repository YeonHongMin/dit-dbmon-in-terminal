pg_stat_topsql:
  query: |
     SELECT
            pg_get_userbyid(userid) as user,
            pg_database.datname,
            pg_stat_statements.queryid,
            SUBSTRING(pg_stat_statements.query FROM 1 FOR 100) AS sql_text,
            pg_stat_statements.calls as calls_total,
            pg_stat_statements.total_exec_time / 1000.0 as seconds_total,
            pg_stat_statements.rows as rows_total,
            pg_stat_statements.blk_read_time / 1000.0 as block_read_seconds_total,
            pg_stat_statements.blk_write_time / 1000.0 as block_write_seconds_total
       FROM pg_stat_statements
       JOIN pg_database
         ON pg_database.oid = pg_stat_statements.dbid
      WHERE total_exec_time > (SELECT percentile_cont(0.1)
                                      WITHIN GROUP (ORDER BY total_exec_time)
                                 FROM pg_stat_statements)
      ORDER BY seconds_total DESC
      LIMIT 200
  metrics:
    - user:
        usage: "LABEL"
        description: "user"
    - datname:
        usage: "LABEL"
        description: "db name"
    - queryid:
        usage: "LABEL"
        description: "queryid"
    - sql_text:
        usage: "LABEL"
        description: "sql_text"
    - calls_total:
        usage: "COUNTER"
        description: "calls_total"
    - seconds_total:
        usage: "COUNTER"
        description: "seconds_total"
    - rows_total:
        usage: "COUNTER"
        description: "rows_total"
    - block_read_seconds_total:
        usage: "COUNTER"
        description: "block_read_seconds_total"
    - block_write_seconds_total:
        usage: "COUNTER"
        description: "block_write_seconds_total"
